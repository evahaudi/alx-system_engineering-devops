#!/usr/bin/env bash
# Description: Gracefully restart Gunicorn with no downtime
# Check if Gunicorn process is running
if pgrep gunicorn > /dev/null; then
    # Get the process IDs of Gunicorn master and workers
    master_pid=$(pgrep -o gunicorn)
    worker_pids=$(pgrep -P "$master_pid")

    # Send HUP signal to the master process for graceful restart
    kill -HUP "$master_pid"

    # Wait for the master and workers to gracefully restart
    sleep 2

    # Print "OK" after successfully restarting Gunicorn
    echo "OK"

    # Print the updated Gunicorn processes
    pgrep -af gunicorn
else
    # Print an error message if Gunicorn is not running
    echo "Gunicorn is not running"
fi

